#====================================================================
# ðŸŒˆ LED Control (Neopixel - SKR Mini E3 V3 PA8)
#====================================================================

[neopixel my_neopixel]
pin: PA8
chain_count: 8
color_order: GRB
initial_RED: 0
initial_GREEN: 0
initial_BLUE: 0

# ðŸ”´ LED Off
[gcode_macro LED_OFF]
gcode:
    SET_LED LED=my_neopixel RED=0 GREEN=0 BLUE=0 TRANSMIT=1

# ðŸ”´ Heating (Merah)
[gcode_macro LED_HEATING]
gcode:
    SET_LED LED=my_neopixel RED=1.0 GREEN=0 BLUE=0 TRANSMIT=1

# ðŸ”µ Printing (Putih / semua warna on)
[gcode_macro LED_PRINTING]
gcode:
    SET_LED LED=my_neopixel RED=1.0 GREEN=1.0 BLUE=1.0 TRANSMIT=1

# ðŸŸ¢ Cooling (Hijau)
[gcode_macro LED_COOLING]
gcode:
    SET_LED LED=my_neopixel RED=0 GREEN=1.0 BLUE=0 TRANSMIT=1

# ðŸŸ  Idle (Biru lembut)
[gcode_macro LED_IDLE]
gcode:
    SET_LED LED=my_neopixel RED=0 GREEN=0.2 BLUE=1.0 TRANSMIT=1

# ðŸŸ¡ Pause (Kuning)
[gcode_macro LED_PAUSE]
gcode:
    SET_LED LED=my_neopixel RED=1.0 GREEN=1.0 BLUE=0 TRANSMIT=1

 # ðŸ”´ Error (steady red)
[gcode_macro LED_ERROR]
gcode:
    # Set LED merah penuh (untuk error steady)
    SET_LED LED=my_neopixel RED=1.0 GREEN=0 BLUE=0 TRANSMIT=1

# ðŸ”´ Error Blink (contoh: berkelip merah)
[gcode_macro LED_ERROR_BLINK]
gcode:
    {% set r = params.R|default(1.0)|float %}
    {% set g = params.G|default(0.0)|float %}
    {% set b = params.B|default(0.0)|float %}
    {% set n = params.N|default(10)|int %}   # bilangan kali berkelip (default 10)
    {% set on_ms = params.ON_MS|default(300)|int %}
    {% set off_ms = params.OFF_MS|default(300)|int %}
    {% for i in range(n) %}
        SET_LED LED=my_neopixel RED={r} GREEN={g} BLUE={b} TRANSMIT=1
        G4 P{on_ms}
        SET_LED LED=my_neopixel RED=0 GREEN=0 BLUE=0 TRANSMIT=1
        G4 P{off_ms}
    {% endfor %}
    # Pastikan akhir tetap merah steady sebagai tanda error
    SET_LED LED=my_neopixel RED={r} GREEN={g} BLUE={b} TRANSMIT=1    

# âœ¨ Blink (default merah berkelip 3 kali)
[gcode_macro LED_BLINK]
gcode:
    {% set r = params.R|default(1.0)|float %}
    {% set g = params.G|default(0.0)|float %}
    {% set b = params.B|default(0.0)|float %}
    {% set n = params.N|default(3)|int %}
    {% for i in range(n) %}
        SET_LED LED=my_neopixel RED={r} GREEN={g} BLUE={b} TRANSMIT=1
        G4 P500
        SET_LED LED=my_neopixel RED=0 GREEN=0 BLUE=0 TRANSMIT=1
        G4 P500
    {% endfor %}

# ðŸŒŠ Breathing (default biru naik turun 3 cycle)
[gcode_macro LED_BREATH]
gcode:
    {% set r = params.R|default(0.0)|float %}
    {% set g = params.G|default(0.0)|float %}
    {% set b = params.B|default(1.0)|float %}
    {% set n = params.N|default(5)|int %}
    {% for i in range(n) %}
        {% for v in range(0, 11) %}
            {% set intensity = v / 10.0 %}
            SET_LED LED=my_neopixel RED={r*intensity} GREEN={g*intensity} BLUE={b*intensity} TRANSMIT=1
            G4 P100
        {% endfor %}
        {% for v in range(10, -1, -1) %}
            {% set intensity = v / 10.0 %}
            SET_LED LED=my_neopixel RED={r*intensity} GREEN={g*intensity} BLUE={b*intensity} TRANSMIT=1
            G4 P100
        {% endfor %}
    {% endfor %}
